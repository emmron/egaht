var N=Object.defineProperty;var G=(t,e)=>()=>(t&&(e=t(t=0)),e);var H=(t,e)=>{for(var n in e)N(t,n,{get:e[n],enumerable:!0})};var I={};H(I,{wasmExports:()=>de});function F(t,e){let n=[];if(!t&&e)n.push({type:"CREATE",node:e});else if(t&&!e)n.push({type:"REMOVE"});else if(t.type!==e.type)n.push({type:"REPLACE",node:e});else if(t.nodeType===2)t.value!==e.value&&n.push({type:"TEXT",value:e.value});else{let s=xe(t.props||{},e.props||{});s.length>0&&n.push({type:"PROPS",patches:s});let o=ye(t.children||[],e.children||[]);o.length>0&&n.push({type:"CHILDREN",patches:o})}return n}function xe(t,e){let n=[],s=new Set([...Object.keys(t),...Object.keys(e)]);for(let o of s){if(o==="key")continue;let r=t[o],c=e[o];r!==c&&n.push({key:o,value:c})}return n}function ye(t,e){let n=[],s=Math.max(t.length,e.length);for(let o=0;o<s;o++){let r=F(t[o],e[o]);r.length>0&&n.push({index:o,patches:r})}return n}function Ee(t){let e=`return (state) => {
`;e+=`  const h = this.h;
`,e+=`  const elements = [];
`;let n=t.split(`
`);for(let s of n){let o=s.trim();if(o.startsWith("<")&&o.endsWith(">")){let r=o.slice(1,-1).split(" ")[0];e+=`  elements.push(h('${r}', {}, []));
`}}return e+=`  return elements.length === 1 ? elements[0] : elements;
`,e+="}",new Function(e)()}function ge(t,e){let n=[],s=new Set;function o(r){s.has(r)||(s.add(r),n.push(r))}return e.forEach(o),n}function _e(t){let e=Date.now()+Math.random();return P.set(e,{name:t,start:performance.now()}),e}function we(t){let e=P.get(t);if(!e)return 0;let n=performance.now()-e.start;return P.delete(t),e.name.includes("diff")?(a.diffs++,a.avgDiffTime=(a.avgDiffTime*(a.diffs-1)+n)/a.diffs):e.name.includes("compile")&&(a.compilations++,a.avgCompileTime=(a.avgCompileTime*(a.compilations-1)+n)/a.compilations),n}function Te(){return JSON.stringify(a)}var de,P,a,U=G(()=>{"use strict";de={init:()=>console.log("Using JavaScript fallback (WASM not available)"),diff_vnodes:F,compile_template:Ee,compute_dependencies:ge,start_timer:_e,end_timer:we,get_performance_stats:Te,alloc:t=>new ArrayBuffer(t),free:()=>{}};P=new Map,a={diffs:0,avgDiffTime:0,compilations:0,avgCompileTime:0}});var f={ELEMENT:1,TEXT:2,COMPONENT:3,FRAGMENT:4};function K(t,e,...n){let s=n.flat(1/0).filter(o=>o!=null).map(o=>typeof o=="string"||typeof o=="number"?W(String(o)):o);return{type:t,props:e||{},children:s,key:e?.key,nodeType:typeof t=="string"?f.ELEMENT:f.COMPONENT}}function W(t){return{type:"#text",value:String(t),nodeType:f.TEXT}}function V(t,...e){return{type:"#fragment",props:t||{},children:e.flat(1/0).filter(n=>n!=null),nodeType:f.FRAGMENT}}function g(t,e){let n=[];if(!t)n.push({type:"CREATE",node:e});else if(!e)n.push({type:"REMOVE"});else if(t.type!==e.type)n.push({type:"REPLACE",node:e});else if(t.nodeType===f.TEXT)t.value!==e.value&&n.push({type:"TEXT",value:e.value});else{let s=Y(t.props,e.props);s.length>0&&n.push({type:"PROPS",patches:s});let o=$(t.children,e.children);o.length>0&&n.push({type:"CHILDREN",patches:o})}return n}function Y(t,e){let n=[],s=new Set([...Object.keys(t),...Object.keys(e)]);for(let o of s){if(o==="key")continue;let r=t[o],c=e[o];r!==c&&n.push({key:o,value:c})}return n}function $(t,e){let n=[],s=Math.max(t.length,e.length);for(let o=0;o<s;o++){let r=g(t[o],e[o]);r.length>0&&n.push({index:o,patches:r})}return n}var _=new WeakMap,q=new Set(["click","input","change","submit","keydown","keyup"]);function Q(t){for(let e of q)t.addEventListener(e,Z,!0)}function Z(t){let e=t.target;for(;e&&e!==t.currentTarget;){let n=_.get(e);n&&n[t.type]&&n[t.type](t),e=e.parentNode}}function u(t){if(!t)return null;if(typeof t=="string"||typeof t=="number")return document.createTextNode(String(t));if(t.nodeType===f.TEXT)return document.createTextNode(t.value);if(t.nodeType===f.FRAGMENT){let e=document.createDocumentFragment();return t.children.forEach(n=>{let s=u(n);s&&e.appendChild(s)}),e}if(t.nodeType===f.ELEMENT){let e=document.createElement(t.type);return D(e,{},t.props),t.children.forEach(n=>{let s=u(n);s&&e.appendChild(s)}),e}if(t.nodeType===f.COMPONENT){let e=document.createElement("div");return e.setAttribute("data-component-placeholder",t.type.name||"Component"),e}}function D(t,e,n){for(let s in e)s in n||te(t,s,e[s]);for(let s in n)e[s]!==n[s]&&ee(t,s,n[s])}function ee(t,e,n){if(e.startsWith("@")){let s=e.slice(1),o=_.get(t)||{};o[s]=n,_.set(t,o)}else e==="class"?t.className=n||"":e==="style"?typeof n=="object"?Object.assign(t.style,n):t.style.cssText=n||"":e in t&&!e.startsWith("aria-")&&!e.startsWith("data-")?t[e]=n:n===!0?t.setAttribute(e,""):n===!1||n==null?t.removeAttribute(e):t.setAttribute(e,n)}function te(t,e,n){if(e.startsWith("@")){let s=e.slice(1),o=_.get(t);o&&delete o[s]}else e==="class"?t.className="":e==="style"?t.style.cssText="":e in t?t[e]="":t.removeAttribute(e)}function w(t,e){for(let n of e)O(t,n)}function O(t,e){switch(e.type){case"CREATE":let n=u(e.node);t.appendChild(n);break;case"REMOVE":t.remove();break;case"REPLACE":let s=u(e.node);t.replaceWith(s);break;case"TEXT":t.textContent=e.value;break;case"PROPS":let o={},r={};e.patches.forEach(c=>{r[c.key]=c.value}),D(t,o,r);break;case"CHILDREN":e.patches.forEach(c=>{let p=t.childNodes[c.index];p&&c.patches.forEach(v=>O(p,v))});break}}var d=null,T=[],S=new WeakMap;function l(t){return typeof t!="object"||t===null?t:new Proxy(t,{get(e,n,s){k(e,n);let o=Reflect.get(e,n,s);return typeof o=="object"&&o!==null?l(o):o},set(e,n,s,o){let r=e[n],c=Reflect.set(e,n,s,o);return r!==s&&C(e,n),c},deleteProperty(e,n){let s=n in e,o=Reflect.deleteProperty(e,n);return s&&C(e,n),o}})}function k(t,e){if(!d)return;let n=S.get(t);n||S.set(t,n=new Map);let s=n.get(e);s||n.set(e,s=new Set),s.add(d),d.deps.push(s)}function C(t,e){let n=S.get(t);if(!n)return;let s=n.get(e);if(!s)return;new Set(s).forEach(r=>{r!==d&&(r.scheduler?r.scheduler():r.run())})}function x(t,e={}){let n=()=>{ne(n),d=n,T.push(n);try{return t()}finally{T.pop(),d=T[T.length-1]}};return n.deps=[],n.scheduler=e.scheduler,n.run=()=>n(),e.lazy||n(),n}function ne(t){let{deps:e}=t;if(e.length){for(let n of e)n.delete(t);e.length=0}}function se(t){let e,n=!0,s=x(t,{lazy:!0,scheduler(){n=!0,C(o,"value")}}),o={get value(){return n&&(e=s(),n=!1),k(o,"value"),e}};return o}function oe(t,e,n={}){let s,o;typeof t=="function"?s=t:s=()=>t;let r=()=>{let p=c();o!==p&&(e(p,o),o=p)},c=x(s,{lazy:!0,scheduler:r});n.immediate?r():o=c()}function re(t){let e={value:t};return Object.defineProperty(e,"__v_isRef",{value:!0}),l(e)}function ce(t){let e=l(t),n=new Set;return{state:e,subscribe(s){return n.add(s),()=>n.delete(s)},dispatch(s){let o=s(e);return n.forEach(r=>r()),o}}}var ie=new Map,j=new WeakMap,b=class{constructor(e={}){this.props=e,this.state=l({}),this.refs={},this._vnode=null,this._element=null,this._mounted=!1,this._effects=[],this._cleanups=[]}onMount(){}onDestroy(){}onUpdate(){}setState(e){Object.assign(this.state,e)}render(){throw new Error("Component must implement render()")}_mount(e){this.onMount(),this._mounted=!0;let n=x(()=>{let s=this.render();if(!this._vnode)this._vnode=s,this._element=u(s),e.appendChild(this._element);else{let o=g(this._vnode,s);w(this._element,o),this._vnode=s,this.onUpdate()}});this._effects.push(n)}_unmount(){this._effects.forEach(e=>e.stop?.()),this._effects=[],this._cleanups.forEach(e=>e()),this._cleanups=[],this.onDestroy(),this._element&&this._element.remove(),this._mounted=!1}};function L(t){return class extends b{constructor(n){super(n),this._hooks=[],this._hookIndex=0}render(){y=this,A=0;try{return t(this.props)}finally{y=null}}_forceUpdate(){if(this._mounted&&this._element){let n=this.render(),s=g(this._vnode,n);w(this._element,s),this._vnode=n}}}}function ae(t,e){ie.set(t,e)}function pe(t){let e=t.type;if(typeof e=="function"&&!e.prototype?.render){let o=L(e),r=new o(t.props),c=document.createElement("div");return c.setAttribute("data-eghact-component",e.name||"FunctionComponent"),r._mount(c),j.set(c,r),c}let n=new e(t.props),s=document.createElement("div");return s.setAttribute("data-eghact-component",e.name),n._mount(s),j.set(s,n),s}var y=null,A=0;function fe(t){let e=y,n=A++;e._hooks||(e._hooks=[]),e._hooks[n]===void 0&&(e._hooks[n]=l({value:t}));let s=e._hooks[n];return[s.value,o=>{s.value=o}]}function ue(t,e){let n=y,s=A++;n._hooks||(n._hooks=[]);let o=n._hooks[s];if(!o||!e||e.some((r,c)=>r!==o[c])){n._hooks[s]=e;let r=t();typeof r=="function"&&n._cleanups.push(r)}}var M=new Map;function le(t){let e=Symbol("context");return M.set(e,{value:t,subscribers:new Set}),e}function me(t){let e=M.get(t);if(!e)throw new Error("Context not found");let n=y;return e.subscribers.add(n),e.value}function he(t,e){let n=M.get(t);if(!n)throw new Error("Context not found");n.value=e,n.subscribers.forEach(s=>s._forceUpdate())}var z=null,i=null,h=null,be=new TextEncoder,ve=new TextDecoder;async function Se(){try{let t=new URL("../wasm/eghact_runtime.wasm",import.meta.url),e=await fetch(t).then(s=>{if(!s.ok)throw new Error("WASM not found");return s.arrayBuffer()});h=new WebAssembly.Memory({initial:256,maximum:4096});let n={env:{memory:h,console_log:(s,o)=>{let r=m(s,o);console.log("[WASM]:",r)},create_element:(s,o)=>{let r=m(s,o),c=E.length;return E.push(document.createElement(r)),c},set_attribute:(s,o,r,c,p)=>{let v=E[s],J=m(o,r),B=m(c,p);v.setAttribute(J,B)},append_child:(s,o)=>{E[s].appendChild(E[o])},performance_now:()=>performance.now()}};return z=await WebAssembly.compile(e),i=await WebAssembly.instantiate(z,n),i.exports.init(),console.log("WASM runtime initialized successfully"),i.exports}catch(t){console.warn("WASM not available, using JavaScript fallback:",t.message);let{wasmExports:e}=await Promise.resolve().then(()=>(U(),I));return i={exports:e},e.init(),e}}var E=[];function m(t,e){let n=new Uint8Array(h.buffer,t,e);return ve.decode(n)}function R(t){let e=be.encode(t),n=i.exports.alloc(e.length);return new Uint8Array(h.buffer,n,e.length).set(e),{ptr:n,len:e.length}}function Ce(t,e){if(!i)throw new Error("WASM not initialized");let n=X(t),s=X(e),o=i.exports.diff_vnodes(n.ptr,n.len,s.ptr,s.len),r=Ae(o);return i.exports.free(n.ptr),i.exports.free(s.ptr),i.exports.free(o),r}function X(t){let e=JSON.stringify(t);return R(e)}function Ae(t){let e=i.exports.get_patches_len(t),n=new Uint32Array(h.buffer,e,1)[0],s=m(t,n);return JSON.parse(s)}function Me(t){if(!i)throw new Error("WASM not initialized");let{ptr:e,len:n}=R(t),s=i.exports.compile_template(e,n),o=i.exports.get_compiled_len(s),r=m(s,o);return i.exports.free(e),i.exports.free(s),r}function Pe(t,e){if(!i)throw new Error("WASM not initialized");let n=new Uint32Array(e),s=i.exports.alloc(n.length*4);new Uint32Array(h.buffer,s,n.length).set(n);let r=i.exports.compute_dependencies(t,s,n.length),c=i.exports.get_result_len(r),p=new Uint32Array(h.buffer,r,c);return i.exports.free(s),i.exports.free(r),Array.from(p)}var Re={startTimer:t=>{let{ptr:e,len:n}=R(t),s=i.exports.start_timer(e,n);return i.exports.free(e),s},endTimer:t=>i.exports.end_timer(t),getStats:()=>{let t=i.exports.get_performance_stats(),e=i.exports.get_stats_len(t),n=m(t,e);return i.exports.free(t),JSON.parse(n)}};async function Be(t,e){let n=await initWASM();return initEventDelegation(e),{_rootComponent:t,_rootElement:e,_mounted:!1,mount(){if(this._mounted){console.warn("App already mounted");return}new t()._mount(e),this._mounted=!0,console.log("Eghact app mounted successfully")},unmount(){if(!this._mounted){console.warn("App not mounted");return}this._mounted=!1}}}var Ne={version:"0.1.0",mode:"pure",features:{wasm:!0,reactive:!0,components:!0,ssr:!1,hydration:!1}};export{b as Component,w as applyPatches,se as computed,Be as createApp,pe as createComponent,le as createContext,u as createElement,L as createFunctionComponent,ce as createStore,x as effect,V as fragment,K as h,Q as initEventDelegation,Se as initWASM,he as provide,l as reactive,re as ref,ae as registerComponent,Ne as runtime,W as text,me as useContext,ue as useEffect,fe as useState,Re as wasmBenchmark,Me as wasmCompileTemplate,Pe as wasmComputeDependencies,Ce as wasmDiff,oe as watch};
//# sourceMappingURL=eghact-runtime.js.map
